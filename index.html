<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bill Splitter</title>
    <style>
      :root {
        color-scheme: light;
        font-family: "Inter", "Segoe UI", sans-serif;
        background: #f5f6f8;
        color: #1f2937;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 32px;
      }

      .page {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        gap: 24px;
      }

      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 24px;
        background: white;
        border-radius: 16px;
        box-shadow: 0 8px 24px rgba(15, 23, 42, 0.08);
      }

      header h1 {
        margin: 0;
        font-size: 24px;
      }

      header p {
        margin: 6px 0 0;
        color: #6b7280;
      }

      .layout {
        display: grid;
        grid-template-columns: minmax(280px, 1fr) minmax(320px, 1.2fr) minmax(280px, 1fr);
        gap: 24px;
      }

      .card {
        background: white;
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 8px 24px rgba(15, 23, 42, 0.08);
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .card h2 {
        margin: 0;
        font-size: 18px;
      }

      .section-label {
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: #6b7280;
      }

      .field-grid {
        display: grid;
        gap: 12px;
      }

      .field {
        display: flex;
        flex-direction: column;
        gap: 6px;
        font-size: 13px;
      }

      input,
      select {
        padding: 8px 12px;
        border-radius: 10px;
        border: 1px solid #d1d5db;
        background: #f9fafb;
        font-size: 14px;
      }

      .button-row {
        display: flex;
        gap: 10px;
      }

      .button {
        padding: 10px 14px;
        border-radius: 10px;
        border: none;
        font-weight: 600;
        background: #2563eb;
        color: white;
        cursor: pointer;
      }

      .button.secondary {
        background: #e5e7eb;
        color: #1f2937;
      }

      .pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 12px;
        background: #f3f4f6;
        border-radius: 999px;
        font-size: 13px;
      }

      .people-list {
        display: grid;
        gap: 12px;
      }

      .person-card {
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 12px;
        display: grid;
        gap: 8px;
      }

      .person-card header {
        padding: 0;
        box-shadow: none;
        background: transparent;
        justify-content: space-between;
      }

      .items {
        display: grid;
        gap: 8px;
      }

      .item-row {
        display: grid;
        grid-template-columns: 1fr 90px auto;
        gap: 8px;
        align-items: center;
      }

      .summary-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-size: 14px;
      }

      .summary-row strong {
        font-size: 16px;
      }

      .validation-panel {
        background: #111827;
        color: white;
        border-radius: 14px;
        padding: 16px;
        display: grid;
        gap: 12px;
      }

      .validation-panel .summary-row {
        color: #e5e7eb;
      }

      .discrepancy {
        padding: 10px 12px;
        border-radius: 10px;
        background: #fef3c7;
        color: #92400e;
        font-weight: 600;
      }

      .discrepancy.warning {
        background: #fee2e2;
        color: #b91c1c;
      }

      .balance-note {
        font-size: 12px;
        color: #9ca3af;
        margin: 0;
      }

      .footer {
        display: flex;
        justify-content: flex-end;
        gap: 12px;
      }

      .helper-text {
        font-size: 12px;
        color: #6b7280;
        margin: 0;
      }

      .empty-state {
        padding: 16px;
        border-radius: 12px;
        border: 1px dashed #d1d5db;
        text-align: center;
        color: #6b7280;
        font-size: 14px;
      }

      @media (max-width: 1000px) {
        .layout {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="page">
      <header>
        <div>
          <h1>Bill Splitter</h1>
          <p>Inline editing with immediate totals and reconciliation.</p>
        </div>
        <div class="pill">Last updated 2 minutes ago</div>
      </header>

      <div class="layout">
        <section class="card">
          <h2>Bill details</h2>
          <div class="field-grid">
            <div class="field">
              <label>Bill name</label>
              <input id="bill-name" type="text" placeholder="Dinner at La Mesa" />
            </div>
            <div class="field">
              <label>Tax</label>
              <input id="bill-tax" type="text" placeholder="$0.00" />
            </div>
            <div class="field">
              <label>Tip</label>
              <input id="bill-tip" type="text" placeholder="$0.00" />
            </div>
            <div class="field">
              <label>Additional fees</label>
              <input id="bill-fee" type="text" placeholder="$0.00" />
            </div>
            <div class="field">
              <label>Bill total (optional)</label>
              <input id="bill-actual-total" type="text" placeholder="$0.00" />
            </div>
            <div class="field">
              <label>Additional fee allocation</label>
              <select id="bill-fee-allocation">
                <option value="even">Even split</option>
                <option value="proportional">Proportional</option>
              </select>
            </div>
          </div>
          <div class="summary-row">
            <span class="section-label">Bill total</span>
            <strong id="bill-total">$0.00</strong>
          </div>
          <p class="helper-text">Totals update as you add items and fees.</p>
        </section>

        <section class="card">
          <div class="summary-row">
            <h2>People</h2>
          </div>
          <p class="section-label">Inline editing for names and item prices</p>
          <div class="people-list" id="people-list"></div>
          <div class="empty-state" id="people-empty">Add someone to start entering items.</div>
          <button class="button" id="add-person">+ Add person</button>
        </section>

        <section class="card">
          <h2>Summary</h2>
          <div class="summary-row">
            <span>Subtotal</span>
            <span id="summary-subtotal">$0.00</span>
          </div>
          <div class="summary-row">
            <span>Tax</span>
            <span id="summary-tax">$0.00</span>
          </div>
          <div class="summary-row">
            <span>Tip</span>
            <span id="summary-tip">$0.00</span>
          </div>
          <div class="summary-row">
            <span>Fees</span>
            <span id="summary-fee">$0.00</span>
          </div>
          <div class="summary-row">
            <strong>Total</strong>
            <strong id="summary-total">$0.00</strong>
          </div>

          <div class="validation-panel">
            <p class="balance-note">
              Track item subtotals here. Validation and reconciliation arrive in milestone 2.
            </p>
            <div id="person-summary"></div>
          </div>

          <div class="footer">
            <button class="button secondary">Save draft</button>
            <button class="button">Finalize split</button>
          </div>
        </section>
      </div>
    </div>
    <script>
      const currencyFormatter = new Intl.NumberFormat("en-US", {
        style: "currency",
        currency: "USD",
      });

      const createId = (() => {
        let index = 0;
        return () => {
          index += 1;
          return `id-${index}`;
        };
      })();

      const state = {
        bill: {
          name: "",
          tax: "",
          tip: "",
          fee: "",
          feeAllocation: "even",
          actualTotal: "",
        },
        people: [],
      };

      const elements = {
        billName: document.querySelector("#bill-name"),
        billTax: document.querySelector("#bill-tax"),
        billTip: document.querySelector("#bill-tip"),
        billFee: document.querySelector("#bill-fee"),
        billActualTotal: document.querySelector("#bill-actual-total"),
        billFeeAllocation: document.querySelector("#bill-fee-allocation"),
        billTotal: document.querySelector("#bill-total"),
        addPerson: document.querySelector("#add-person"),
        peopleList: document.querySelector("#people-list"),
        peopleEmpty: document.querySelector("#people-empty"),
        summarySubtotal: document.querySelector("#summary-subtotal"),
        summaryTax: document.querySelector("#summary-tax"),
        summaryTip: document.querySelector("#summary-tip"),
        summaryFee: document.querySelector("#summary-fee"),
        summaryTotal: document.querySelector("#summary-total"),
        personSummary: document.querySelector("#person-summary"),
      };

      const parseCurrency = (value) => {
        if (!value) return 0;
        const numeric = Number.parseFloat(value.replace(/[^0-9.-]/g, ""));
        return Number.isNaN(numeric) ? 0 : numeric;
      };

      const formatCurrency = (value) => currencyFormatter.format(value);

      const getPersonSubtotal = (person) =>
        person.items.reduce((total, item) => total + parseCurrency(item.price), 0);

      const getItemsSubtotal = () =>
        state.people.reduce((total, person) => total + getPersonSubtotal(person), 0);

      const renderSummary = () => {
        const subtotal = getItemsSubtotal();
        const tax = parseCurrency(state.bill.tax);
        const tip = parseCurrency(state.bill.tip);
        const fee = parseCurrency(state.bill.fee);
        const total = subtotal + tax + tip + fee;

        elements.summarySubtotal.textContent = formatCurrency(subtotal);
        elements.summaryTax.textContent = formatCurrency(tax);
        elements.summaryTip.textContent = formatCurrency(tip);
        elements.summaryFee.textContent = formatCurrency(fee);
        elements.summaryTotal.textContent = formatCurrency(total);
        elements.billTotal.textContent = formatCurrency(total);
      };

      const renderPersonSummary = () => {
        elements.personSummary.innerHTML = "";
        if (!state.people.length) {
          elements.personSummary.innerHTML =
            '<p class="balance-note">No people yet. Add someone to see their subtotal.</p>';
          return;
        }
        state.people.forEach((person) => {
          const row = document.createElement("div");
          row.className = "summary-row";
          row.innerHTML = `<span>${person.name || "Untitled"}</span><strong>${formatCurrency(
            getPersonSubtotal(person)
          )}</strong>`;
          elements.personSummary.appendChild(row);
        });
      };

      const renderPeople = () => {
        elements.peopleList.innerHTML = "";
        state.people.forEach((person) => {
          const card = document.createElement("div");
          card.className = "person-card";
          card.dataset.person = person.id;

          const header = document.createElement("header");
          header.innerHTML = `
            <strong>${person.name || "Untitled person"}</strong>
            <span class="pill">${formatCurrency(getPersonSubtotal(person))}</span>
          `;

          const items = document.createElement("div");
          items.className = "items";

          person.items.forEach((item) => {
            const row = document.createElement("div");
            row.className = "item-row";
            row.innerHTML = `
              <input type="text" value="${item.name}" placeholder="Item name" data-person="${person.id}" data-item="${item.id}" data-field="name" />
              <input type="text" value="${item.price}" placeholder="$0.00" data-person="${person.id}" data-item="${item.id}" data-field="price" />
              <button class="button secondary" data-person="${person.id}" data-item="${item.id}" data-action="remove-item">Remove</button>
            `;
            items.appendChild(row);
          });

          const addItemButton = document.createElement("button");
          addItemButton.className = "button";
          addItemButton.textContent = "+ Add item";
          addItemButton.dataset.person = person.id;
          addItemButton.dataset.action = "add-item";
          items.appendChild(addItemButton);

          const nameField = document.createElement("div");
          nameField.className = "field";
          nameField.innerHTML = `
            <label>Person name</label>
            <input type="text" value="${person.name}" data-person="${person.id}" data-field="person-name" />
          `;

          const removeButton = document.createElement("button");
          removeButton.className = "button secondary";
          removeButton.textContent = "Remove person";
          removeButton.dataset.person = person.id;
          removeButton.dataset.action = "remove-person";

          card.appendChild(header);
          card.appendChild(nameField);
          card.appendChild(items);
          card.appendChild(removeButton);
          elements.peopleList.appendChild(card);
        });

        elements.peopleEmpty.style.display = state.people.length ? "none" : "block";
      };

      const render = () => {
        renderPeople();
        renderSummary();
        renderPersonSummary();
      };

      const updateBillField = (field, value) => {
        state.bill[field] = value;
        renderSummary();
      };

      const updatePersonCard = (personId) => {
        const card = elements.peopleList.querySelector(
          `.person-card[data-person="${personId}"]`
        );
        if (!card) return;
        const person = state.people.find((entry) => entry.id === personId);
        if (!person) return;
        const headerName = card.querySelector("header strong");
        const headerPill = card.querySelector("header .pill");
        if (headerName) {
          headerName.textContent = person.name || "Untitled person";
        }
        if (headerPill) {
          headerPill.textContent = formatCurrency(getPersonSubtotal(person));
        }
      };

      const formatCurrencyInput = (input) => {
        const value = parseCurrency(input.value);
        input.value = value ? formatCurrency(value) : "";
      };

      const updatePersonName = (personId, value) => {
        const person = state.people.find((entry) => entry.id === personId);
        if (person) {
          person.name = value;
          updatePersonCard(personId);
          renderPersonSummary();
        }
      };

      const updateItemField = (personId, itemId, field, value) => {
        const person = state.people.find((entry) => entry.id === personId);
        if (!person) return;
        const item = person.items.find((entry) => entry.id === itemId);
        if (!item) return;
        item[field] = value;
        updatePersonCard(personId);
        renderSummary();
        renderPersonSummary();
      };

      const addPerson = () => {
        state.people.push({
          id: createId(),
          name: "",
          items: [
            { id: createId(), name: "", price: "" },
            { id: createId(), name: "", price: "" },
          ],
        });
        render();
      };

      const removePerson = (personId) => {
        state.people = state.people.filter((person) => person.id !== personId);
        render();
      };

      const addItem = (personId) => {
        const person = state.people.find((entry) => entry.id === personId);
        if (!person) return;
        person.items.push({ id: createId(), name: "", price: "" });
        render();
      };

      const removeItem = (personId, itemId) => {
        const person = state.people.find((entry) => entry.id === personId);
        if (!person) return;
        person.items = person.items.filter((item) => item.id !== itemId);
        render();
      };

      elements.addPerson.addEventListener("click", addPerson);

      elements.peopleList.addEventListener("input", (event) => {
        const target = event.target;
        if (!(target instanceof HTMLInputElement)) return;
        const personId = target.dataset.person;
        const itemId = target.dataset.item;
        const field = target.dataset.field;
        if (field === "person-name" && personId) {
          updatePersonName(personId, target.value);
        }
        if (personId && itemId && field) {
          updateItemField(personId, itemId, field, target.value);
        }
      });

      elements.peopleList.addEventListener("blur", (event) => {
        const target = event.target;
        if (!(target instanceof HTMLInputElement)) return;
        if (target.dataset.field === "price") {
          formatCurrencyInput(target);
        }
      }, true);

      elements.peopleList.addEventListener("click", (event) => {
        const target = event.target;
        if (!(target instanceof HTMLElement)) return;
        const action = target.dataset.action;
        const personId = target.dataset.person;
        const itemId = target.dataset.item;
        if (!action || !personId) return;
        if (action === "add-item") {
          addItem(personId);
        }
        if (action === "remove-item" && itemId) {
          removeItem(personId, itemId);
        }
        if (action === "remove-person") {
          removePerson(personId);
        }
      });

      elements.billName.addEventListener("input", (event) => {
        updateBillField("name", event.target.value);
      });
      elements.billTax.addEventListener("input", (event) => {
        updateBillField("tax", event.target.value);
      });
      elements.billTip.addEventListener("input", (event) => {
        updateBillField("tip", event.target.value);
      });
      elements.billFee.addEventListener("input", (event) => {
        updateBillField("fee", event.target.value);
      });
      elements.billActualTotal.addEventListener("input", (event) => {
        updateBillField("actualTotal", event.target.value);
      });

      elements.billTax.addEventListener("blur", (event) => {
        formatCurrencyInput(event.target);
      });
      elements.billTip.addEventListener("blur", (event) => {
        formatCurrencyInput(event.target);
      });
      elements.billFee.addEventListener("blur", (event) => {
        formatCurrencyInput(event.target);
      });
      elements.billActualTotal.addEventListener("blur", (event) => {
        formatCurrencyInput(event.target);
      });
      elements.billFeeAllocation.addEventListener("change", (event) => {
        updateBillField("feeAllocation", event.target.value);
      });

      addPerson();
      addPerson();
    </script>
  </body>
</html>
